<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="//cdn.jsdelivr.net/npm/phaser@3.50.0/dist/phaser.min.js"></script>

</head>
<body>
  <script type = "text/javascript" src="pong.js" >
  </script>

<script>
  var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade'
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
  };

  var game = new Phaser.Game(config);
  // var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update: update });

  let ball;
  let bottomBorder;
  let topBorder;
  let leftBorder;
  let rightBorder;
  let leftPaddle;
  let rightPaddle;
  let leftY;
  let rightY;

  function preload ()
  {
    this.load.image('eye', 'assets/lance-overdose-loader-eye.png');

  }

  function create ()
  {
    const makeWall = (rect) => {
      this.physics.add.existing(rect, true)
      this.physics.add.collider(rect, ball)
    }

    const makePaddle = (rect) => {
      this.physics.add.existing(rect, true)
      this.physics.add.collider(rect, ball)
    }

    ball = this.physics.add.sprite(150, 150, 'eye').setInteractive().setVelocity(-100,100).setBounce(1,1);
    topBorder = this.add.rectangle(this.cameras.main.centerX, 0, this.cameras.main.centerX * 2, 10, 0xFF0000)
    bottomBorder = this.add.rectangle(this.cameras.main.centerX, this.cameras.main.centerY * 2, this.cameras.main.centerX * 2, 10, 0xFF0000)

    let walls = [topBorder, bottomBorder]
    walls.map(makeWall)

    leftY = this.cameras.main.centerY;
    rightY = this.cameras.main.centerY;
    leftPaddle = this.add.rectangle(30, this.cameras.main.centerY, 10, 150, 0xFF0000)
    // TODO: Find a way to get right screen location for x position
    rightPaddle = this.add.rectangle(770, this.cameras.main.centerY, 10, 150, 0xFF0000)
    let paddles = [leftPaddle, rightPaddle]
    paddles.map(makePaddle)

    // TODO: Refactor to condense
    this.input.keyboard.on('keydown-W', (key) => {
      moveLeftPaddle(leftPaddle, 'up');
    })
    this.input.keyboard.on('keydown-S', (key) => {
      moveLeftPaddle(leftPaddle, 'down');
    })
    this.input.keyboard.on('keydown-O', (key) => {
      moveRightPaddle(rightPaddle, 'up');
    })
    this.input.keyboard.on('keydown-L', (key) => {
      moveRightPaddle(rightPaddle, 'down');
    })
  }

  function update() 
  {

  }

  // TODO: Consolidate into a single move function
  // I wanted to have a getPosition instead of leftY and rightY
  function moveLeftPaddle(paddle, dir) {
    if (dir === 'up') {
      paddle.setPosition(30, leftY -= 10)
    } else if (dir === 'down') {
      paddle.setPosition(30, leftY += 10)
    }
  }
  function moveRightPaddle(paddle, dir) {
    if (dir === 'up') {
      paddle.setPosition(770, rightY -= 10)
    } else if (dir === 'down') {
      paddle.setPosition(770, rightY += 10)
    }
  }

  // FIXME: 
  // There's a collision issue where the ball passes through left paddle
  // Paddle movements are not smooth at all
  // Both paddles can't be moving at the same time

  // TODO: 
  // Refactor repetitive code
  // Add paddle collision to walls
  // Dashed line down center
  // Scores on left and right of line
  // Randomize(ish) which direction the ball starts traveling in
  // Change score and restart when sprite leaves the screen
</script>



</body>
</html>